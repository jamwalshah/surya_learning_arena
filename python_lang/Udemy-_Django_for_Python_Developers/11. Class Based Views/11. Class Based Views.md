# 11. Class Based Views

## 107. CBV in Action

- In this lecture, you'll create your very first `Class-Based-View`
- To do that, goto the terminal/command-line, under the projects directory `djangoprojects`, create a new project `classBasedViews` using command below

  ```bash
  django-admin startproject classBasedViews
  ```

- Change directory into project directory `classBasedViews`

  ```bash
  cd classBasedViews
  ```

- Create a Django App `cbvApp` in this project

  ```bash
  python manage.py startapp cbvApp
  ```

- Goto the project directory `djangoprojects\classBasedViews` and open it in your IDE
- Open `views.py` file, Creating a Class-Based-View is very easy, so create a class `GreetingView()` which should extend `View` from `django.views.generic`
  - And within this class `GreetingView()`, we're going to define separate methods for each HTTP method we're going to support, for now just add `get(self, request)`, so when a HTTP `GET` method is invoked this method will get the request and also has access to self, within this method we'll return the `HttpResponse()` just like we've done earlier by importing `HttpResponse` from `django.http`, and pass in the string that you want

    ```python
    from django.shortcuts import render
    from django.views.generic import View
    from django.http import HttpResponse

    # Create your views here.
    class GreetingView(View):
        def get(self, request):
            return HttpResponse("<b>First CBV says hello !!</b>")
    ```

- Goto `urls.py` file which is under the project itself, configure a new `path()` setting the route as root directory `/` by specifying an empty string, and view as a call to `as_view()` method in `views.GreetingView` which is expected to be callable object/method so that this additional step of `as_view()` will invoke a function call to return an HTTP Response.
  - So when a GET request is received on this URL path, it creates an instance of views class `GreetingView`, the request goes to the `get()` method of this class which will return a `HttpResponse` with some content that will be rendered to the template.

    ```python
    from django.contrib import admin
    from django.urls import path
    from cbvApp import views

    urlpatterns = [
        path('admin/', admin.site.urls),
        path('', views.GreetingView.as_view()),
    ]
    ```

- Goto `settings.py` file
  - goto `INSTALLED_APPS` property and append the App `cbvApp` here

    ```python
    INSTALLED_APPS = [
        'django.contrib.admin',
        'django.contrib.auth',
        'django.contrib.contenttypes',
        'django.contrib.sessions',
        'django.contrib.messages',
        'django.contrib.staticfiles',
        'cbvApp'
    ]
    ```

- Goto the terminal/command-line, start the Django server using command below

  ```bash
  python manage.py runserver
  ```

- Open the web-browser and visit the URL at `localhost:8000`, and it should display a message `First CBV says hello !!`
- In this lecture, we've successfully created a Class-Based-View
  - We've created a project, then an Application
  - Within `views.py` we've created a class `GreetingView` which inherits from `django.views.generic.View` and inside this class we need to override the HTTP methods, one method for each HTTP method, if you want to support the `GET` request then implement the `get()` method, and if you want support the `POST` request then implement the `post()` method and so on.
  - This `get()` method takes a request and we need to return an `HttpResponse`
  - In `urls.py` the `path()` method expects a callable object/method, we can't use only the view class name, so we use `views.GreetingView.as_view()`
  - When a request comes in, internally this `as_view()` method will resolve to the view class `GreetingView` and is responsible for figuring which method (GET/POST/etc.) is coming in the incoming request and will call the appropriate method on this class, if is `GET` request, it'll call `get()` method or if it is `POST` request, it'll call the `post()` method and so on

## 108. Setting Attributes on a CBV

- All the code in Class-Based-Views will go into the the methods that we define in the view class
- But we can also define attribute in this class, although not required, we can define attributes in the class and set/assign values to those attributes from within the `as_view()` function at runtime
- Goto `views.py` file, and we'll customize the message content that is displayed from the `get()` function instead of hardcoding it like earlier, by passing a message right from `as_view()` function call from the `path()` in `urls.py`, modify the `views.py` as per code below

  ```python
  from django.shortcuts import render
  from django.views.generic import View
  from django.http import HttpResponse

  # Create your views here.
  class GreetingView(View):
      greetingMessage = '<b>First CBV says hello !!</b>'
      def get(self, request):
          return HttpResponse(content=self.greetingMessage)
  ```

- Now we can override this `greetingMessage` from within the `as_view()` in `urls.py` as below

  ```python
  from django.contrib import admin
  from django.urls import path
  from cbvApp import views

  urlpatterns = [
      path('admin/', admin.site.urls),
      path(route='', view=views.GreetingView.as_view(greetingMessage = '<h1>Hello from the as_view method</h1>')),
  ]
  ```

- This is how we can pass the data or set the attributes on a particular view from the `urls.py` file, because when the Django server request comes in, `as_view()` method will create an instance of the view class `GreetingView` and it is also responsible for setting the values for all the attribute in that class, internally it'll use other methods to do that, so we can pass to it whichever attribute we want
- Django server should've reloaded everything for us, goto the web-browser and refresh the URL at `localhost:8000` and you'll see a different message that says `Hello from the as_view method`
- Initially `First CBV says hello !!` will be the message it'll hold, but when the request comes in it'll set `Hello from the as_view method` as the value

## 109. Hands on Steps

- In the next few lectures, you'll be performing CRUD operations on the same `Student` model/database table that you've created earlier, but this time using Class-Based-Views, it's going to be much more easier than compared to Function-Based-Views to perform the CRUD operations
