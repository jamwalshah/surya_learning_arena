# 06. Models

## 043. Introduction

- The next important component in the `MVT (Model View Template)` architecture is the `Model` component
- `Model` represents the database table and it is through this Model that our view will perform all the database operations
- So, each `Model` in our application will represent a `database table`, and every `Model class` that we create will inherit/extend `django.db.models.Model` class, and they'll have the corresponding fields
- for example, `Employee` model here has `firstName`, `lastName`, `salary`, each of these fields will represent a database table column, so an `Employee` table will have a `firstName`, `lastName` and `salary` columns
- The beauty of Django is that we can create the database structure from our models using commands like `makemigrations`
- The `makemigrations` command when you execute it, will generate the SQL code from your model class by looking at your model class and using that SQL we can create the database tables by using the `migrate` command
- From that point, you can maintain all your database tables through these two commands
  1. `makemigrations`
  2. `migrate`
- So, if you add a new column later on to your `Employee` model, you can execute these commands again, it'll just do the `ALTER` command on the database and data will stay intact
- Along with your application tables, when you migrate, Django also creates many other tables which are required for the administration that is `admin` application that comes with Django, and that application will use the `admin` tables
- There are other tables like `security` table which are useful for authentication and authorization which we'll be using later on and also, when you do session management, Django will have tables for that as well too
  - You store the session information, Django will generate certain special tables
- Along with your application related tables like `Employees`, `Students`, etc., Django will create other tables for free when you execute `makemigrations` and `migrate` commands, and it'll internally use them
- Simply remember that every model that you create will represent a database table and your model class will have all the fields which represent the table columns, and also model can perform various database operations without writing any SQL which we'll learn in the next few lectures

## 044. Hands on Steps

- In the next few lectures, you'll create your very first model called `Employee` with four fields `First Name`, `Last Name`, `Salary` and `Email`
- You'll then create a database table for this `Employee` using the `migrate` tool that Django provides you with
- Here are the steps that you'll follow
  1. Create the project
  2. Configure the database
      - by default Django will use the `sqlite` database
      - and you're going to configure the `MySQL` database for your project
  3. Create the `Employee` model class
  4. Make the migrations
      - `makemigrations` will generate all the SQL code required to create the database tables
      - execute the `migrate` command that will create the database tables
  5. Use the model inside the view, fetch the data from the database using the model in your view and render it on the UI using a template as follows

## 045. Create a project

- In this lecture, you'll create a new project, see its database configuration that comes by default, and also validate that database configuration, that is we'll see if we can connect to that database
- Goto terminal/command-line, make sure you're in the `djangoprojects` directory, create a new project using command below, hit enter and we have a project

```bash
django-admin startproject modelDemo
```

- Go inside the project `modelDemo` using command below

```bash
cd modelDemo
```

- we can create an application `empApp` using command below for an employee, hit enter and we have a new application created

```bash
python manage.py startapp empApp
```

- Now, go back to your file explorer open the `modelDemo` project in your IDE, and open the `settings.py` file, search for 'DATABASES', and there you'll see the databases that have been configured
  - By default, every Django web-application comes with a `sqlite` database for free, and as you can see it is located directly under the `BASE_DIR` of your project

  ```python
  DATABASES = {
      'default': {
          'ENGINE': 'django.db.backends.sqlite3',
          'NAME': BASE_DIR / 'db.sqlite3',
      }
  }
  ```

  - Right under your project directory, there will be a sqlite database and we can right away use it, create models, do the migrations, and when you migrate all the tables will be created inside `db.sqlite3` database
  - This `sqlite` is very good for testing and to work locally, but in real-time applications, when we deploy it om testing or production environments, we won't be using it, instead we use MySQL, Oracle, etc.
  - If you want to validate that if your application can connect to this database, `ENGINE` and `NAME` is that part which shows database connection information, sqlite doesn't need much information to connect, all it needs is `ENGINE` and the name of the database 'db.sqlite3' which is indicated by `NAME` key
  - But, MySQL, Oracle databases will need more information like the username, password, etc. which we'll learn in the next lecture
  - To validate if your application can connect to this application, goto terminal/command-line, make sure you're under the project directory `djangoprojects/modelDemo` and open up a special shell using below command and it'll open up a shell for you where you can use Django packages here

  ```bash
  python manage.py shell
  ```

  - Now, in this new python shell, run below code/command to import the `connection` from `django.db` package

  ```python
  from django.db import connection
  ```

  - Now, run below code/command, if you're able to create this cursor successfully that means your application can connect to the database and our database configuration information is correct

  ```python
  c = connection.cursor()
  ```

  - To come out of this shell hit `Ctrl+D` or type command `exit`
  - by default, under the project directory, there is a `db.sqlite3` that is a database which is okay for development but we're not going to use it
  - At some point, instructor will show you how to use it, but we're going to use MySQL, which you'll configure in the next lecture

## 046. Using MySQL Database

- In this lecture, we'll see how to configure MySQL database for our application and project
- We can do that using the following configurations/properties in the `settings.py` file
  1. `ENGINE`
      - the engine name
  2. `NAME`
      - the name of the database itself
  3. `USER`
      - the user to connect to the database
  4. `PASSWORD`
      - the password that we should use for that user
  5. `HOST`
      - a hostname is it is running on a remote machine or a server
  6. `PORT`
      - the port number
- If we don't provide some of these fields such as `HOST` and `PORT` it'll consider the local machine as the host and default port number on which that database runs
- Lets configure MySQL database, and for this MySQL database server should be up and running
- Also, launch your MySQL workbench which is a MySQL client tool
  - Goto a new SQL window by clicking on `+` icon on the left-corner of your screen
- Once you have that, go back to your IDE, and open the `settings.py` file snd goto `DATABASES` configuration in it
  - for MySQL the very simple change here is that `django.db.backends.sqlite3` will become `django.db.backends.mysql` for the value of `ENGINE` , and provide the name of the MySQL database in `NAME`
  - Now, goto MySQL Workbench, and run below command to create a MySQL database `employeedb12`

  ```SQL
  CREATE DATABASE employeedb12;
  ```

  - Now you can configure the `NAME` in `DATABASES` property in `settings.py` using the database name which you just created
  - The next property is `USER`, when you install MySQL you have a 'root' user which is exactly what you should be using here
  - And, the password for the 'root' user needs to be provided using the `PASSWORD` field, what ever password you have provided while installing MySQL initially, you should be using that here
  - You need not provide the `HOST` and `PORT`, it'll use the default hostname and port number
  - If you're running it on a remote machine or a server, you can use the `HOST` and `PORT` as well

  ```python
  DATABASES = {
      'default': {
          'ENGINE': 'django.db.backends.mysql',
          'NAME': 'employeedb12',
          'USER': 'root',
          'PASSWORD': 'mysql',
      }
  }
  ```

  - To validate these `DATABASES` property, go to command-line/terminal, if you already have python shell for project open, you can use it, and if not use command below to launch a python shell for project

  ``` bash
  python manage.py shell
  ```

  - Now, import the `connection` from `django.db`

    ```python
    from django.db import connection
    ```

  - Now, create a `cursor()` object from `connection`, after running below command

    ``` python
    c = connection.cursor()
    ```

  - if you don't see any error, it means it is able to connect to MySQL database, because it'll use the set configuration from `DATABASES` property in `settings.py` file to connect to whatever database we specify
- So, in this lecture you've successfully configured a MySQL database by creating a new database `employeedb12`

## 047. Create the model

- The next step is to create a Model class called `Employee`
- Goto your IDE, we create the Model class inside `models.py` file, so go inside `empApp` application directory and open the `models.py` file
  - You already have an import statement indicated below to import `models`, and from this `models` we use class `Models` that our model will inherit

  ```python
  from django.db import models
  ```

  - Create a class `Employee` which extends `models.Model`, so every model class will be inherited from `models.Model` class
  - Now you can specify all the fields you have inside this class
    - You need to specify what type of each field is and you can also specify any kind of restrictions you want here such as `max_length=30`
    - `models` package gives us the ability to do all this, which is to specify what type of a field is and to specify its restrictions like `NOT NULL` etc.
    - By default, all the fields on model are `NOT NULL` in the database and when the database gets generated from this you'll see that they're `NOT NULL` fields
  - Create four fields in this class
    - `firstName` as `CharField` with `max_length=30`
    - `lastName` as `CharField` with `max_length=30`
    - `salary` as `FloatField`
    - `email` as `CharField` with `max_length=35`
  
  ```python
  class Employee(models.Model):
    firstName = models.CharField(max_length=30)
    lastName = models.CharField(max_length=30)
    salary = models.FloatField()
    email = models.CharField(max_length=35)
  ```

- In this lecture, you've successfully created your very first Model class by going to `models.py`, you've used `models.Model` class that your model should extend and within your class you've defined all the fields that this model should contain
- When we generate database tables from this model these four columns on the table along with the `id` column that `Django` adds to every table

## 048. Converting Model to DB tables

- In this lecture we'll generate the database code that us responsible for creating all the tables for us from this model
- But, first we need to take an additional step, goto `settings.py`, search for `INSTALLED_APPS`, and we need to add our app `empApp` in this property which we missed right when we created this app, so now our application will be a part of our project

```python
INSTALLED_APPS = [
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
    'empApp',
]
```

- To create tables, goto terminal.command-line, make sure you're under the project directory
- To make migrations we use command below, and if you hit enter it'll generate the database code from the Model class

```bash
python manage.py makemigrations
```

- After you run this command it says Migrations for `empApp` are created under `empApp/migrations/001_initial.py`
- You can view this `0001_initial.py` file by going to your IDE, open folder `migrations` inside `empApp` application folder, and open the `0001_initial.py` file, and this file contains only the python part
- If you want to get the SQL that will be generated out of it, goto terminal/command-line and run below command, we don't use this command every time but if you want to see what kind of SQL it generates, when you hit enter it shows you the exact SQL it will use to create the table for us

```bash
python manage.py sqlmigrate <AppName> <prefix Number of initial.py>
```

```bash
python manage.py sqlmigrate empApp 0001
```

```SQL
--
-- Create model Employee
--
CREATE TABLE `empApp_employee` (`id` bigint AUTO_INCREMENT NOT NULL PRIMARY KEY, `firstName` varchar(30) NOT NULL, `lastName` varchar(30) NOT NULL, `salary` double precision NOT NULL, `email` varchar(35) NOT NULL);
```

- Here, `id` field is added automatically as an `AUTO_INCREMENT`, so it'll be incremented automatically and we need not increment it each time manually
  - Note that `firstName`, `lastName` and `email` fields are created as `VARCHAR` with the specified length, `salary` is `DOUBLE` type and all the fields are `NOT NULL` by default
  - If you want to make a field as `NULL`, you need to add a property to the field in model as `null=True`
- It has not created the table yet
- Every time you do `makemigrations` it'll generate a new file with different prefix of `initial.py`
- To Migrate, goto command-line/terminal, run command below and it'll execute all the command that we need, it creates Django tables and also `empApp` app tables

```bash
python manage.py migrate
```

- Now, you can goto MySQL workbench, run commands to see all the tables which Django has created from migrations

```SQL
USE employeedb12;
SHOW TABLES;
```

- Django will create all these admin & security related tables and at the end we care about for now is the `empapp_employee`
- run below command in MySQL workbench and we'll see all the fields from models and `id` field

```SQL
SELECT * FROM empapp_employee;
```

- In this lecture, you've successfully made the migrations which will generate SQL code, and then you've performed a migrate and execute the SQL, so as a result we got all the tables in the database, and also our custom table which we have created

## 049. Use the model in view

- In this lecture
